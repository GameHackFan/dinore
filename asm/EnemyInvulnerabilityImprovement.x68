*----------------------------------------------------------------------------------------------
* Title:        DINORE Enemy Get Up Improvement
* Written by:   GameHackFan
* Date:         
* Description:  It has routines to ensure some enemies will get 
*               up with some frames of invulnerability after  
*               being knockdown.
*----------------------------------------------------------------------------------------------

; ORG         $181400

                                        ; Check if the enemy should become invulnerable.
  CLR.W       D0                        ; Clears D0.
  MOVE.B      ($3, A6), D0              ; Stores ($3 + A6) inside D0, the enemy ID.
  MOVE.B      ($18, PC, D0.W), D0       ; Store ($18 + PC + D0.W) inside D0, the enemy update target flag.
  TST.B       D0                        ; Compares 0 and D0.
  BLT         $181412                   ; If it is less or equals 0, ignore the line below.
  MOVE.B      #$4, (A6)                 ; Stores 4 inside (A6), the invulnerability flag.
  RTS                                   ; Returns back to the routine that called this code.



  JSR         $1814B0                   ; Replace 5882E, 4C038, 53FDA, 36C34, 67ED2.
  NOP
  NOP
  NOP
  NOP
  NOP
  NOP

; ORG         $1814B0

                                        ; Block of code that sets back the vulnerability.
  MOVE.B      ($79, A6), D1             ; Code from the original game that was replaced to jump to this code.
  BEQ         $1814C6                   ; Code from the original game readjusted.
  SUBQ.B      #$1, ($79, A6)            ; Code from the original game that was replaced to jump to this code.
  BNE         $1814C6                   ; Code from the original game readjusted.
  MOVE.B      #$B, ($78, A6)            ; Code from the original game that was replaced to jump to this code. 
  MOVE.B      #$1, (A6)                 ; Stores 1 inside (A6), the vulnerability flag.
  RTS                                   ; Returns back to the routine that called this code.
  


  JSR         $1814E0                   ; Replace 51890.
  NOP
  NOP
  NOP
  NOP
  NOP
  NOP

; ORG         $1814E0

                                        ; Block of code that sets back the vulnerability.
  MOVE.B      ($79, A6), D1             ; Code from the original game that was replaced to jump to this code.
  BEQ         $1814F6                   ; Code from the original game readjusted.
  SUBQ.B      #$1, ($79, A6)            ; Code from the original game that was replaced to jump to this code.
  BNE         $1814F6                   ; Code from the original game readjusted.
  MOVE.B      #$A, ($78, A6)            ; Code from the original game that was replaced to jump to this code. 
  MOVE.B      #$1, (A6)                 ; Stores 1 inside (A6), the vulnerability flag.
  RTS                                   ; Returns back to the routine that called this code.



  JMP         $181510                   ; Replace 2B55C.

; ORG         $181510

                                        ; Block of code that adapts the active flag to the new invulnerability feature.
  MOVE.B      (A6), D0                  ; Stores (A6) inside D0, the current enemy active flag.
  LSR.B       #1, D0                    ; Shifts right D0 bits by 1, 2 is 1, 1 is 0, 4 is 2. 
  BSET.L      #0, D0                    ; Sets the 1st bit of D0 to 1.
  MOVE.B      D0, (A6)                  ; Stores D0 inside (A6), the enemy active flag.
  JMP         $2B562                    ; Jumps back to where it stopped in the original code.



; This module provides routines that adds invulnerability 
; to enemies based on a flag inside a table. It also 
; has routines that adapts the enemies to allow being 
; invulnerable. Only enemies with flags set to 1 or 
; more will be able to become invulnerable.
;
; 181400:   Activate Enemy Invulnerability (Current Enemy)
; 1814B0:   Remove Enemy Invulnerability (Butcher, Slice, Morgue, Tyrog, Fessenden 1st Form)
; 1814E0:   Remove Enemy Invulnerability (Morgan)
; 181510:   Add Invulnerability Compatibility When Getting Up (Current Enemy)
;
; 181420:   Character ID Table
;           Add the data below.
;
; FF FF FF FF 05 FF FF FF FF FF FF FF FF FF 0F FF
; FF FF FF FF 15 FF FF 16 19 FF FF FF FF FF FF FF
; FF FF FF FF 25 FF FF FF FF FF FF FF FF FF FF FF
; FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
; FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
; FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
; FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
; FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF